# ずんだもんBot セットアップとテスト手順

## 準備するもの
- インターネット接続、パソコン、Discordアカウント、Replitアカウント。

## セットアップ手順
1. **Replitアカウントを作成**:
   - [https://replit.com](https://replit.com) にアクセスし、無料登録。
2. **Replitプロジェクトを作成**:
   - ダッシュボードで「+ New Repl」をクリック。
   - 言語を「Python」に設定し、名前を「zunda-bot」と入力。
3. **コードを追加**:
   - `main.py`に`zunda_bot.py`の内容をコピー＆ペースト。
4. **依存ライブラリをインストール**:
   - シェルで以下を実行：`pip install discord.py openrouter transformers tiktoken bitsandbytes`
5. **環境変数を設定**:
   - Replitの「Secrets」タブで以下を設定：
     - `TOKEN`: Discord Botトークン。
     - `CHANNEL_ID`: 特定チャンネルID（整数）。
     - `DEEPSEEK_API_KEY`: DeepSeek APIキー。
6. **コードを実行**:
   - Replitの「Run」ボタンをクリック。

## テスト手順
- **通常使用（1秒待機）**:
  - `!zunda start`で起動後、「ずんだもん」とチャットに書いて質問（例: 「ずんだもん、元気？」）。
  - 通常は1秒以内に東北弁で応答が返るはず。処理が軽快に動作するか確認。
- **活発な使用（30秒待機）**:
  - 1秒以内に5回以上または1分以内に5回以上質問を送り、レート制限が発動するか確認。
  - 「ずんだもん、ちょっと多忙すぎちゃったのだ…1分待ってほしいのだよ！」というメッセージが表示され、30秒待機後応答が返るか確認。
- **通知オプション**:
  - `!zunda notify off`で通知をオフにし、通知メッセージが表示されないか確認。
  - `!zunda notify on`で通知をオンに戻し、通常の通知が復元するか確認。
- **エラーログ確認**:
  - 意図的にエラーを発生（例: APIキーの無効化）し、`error_logs.txt`にタイムスタンプ付きでエラーが記録されているか確認。
- **トークン制限確認**:
  - トークン使用量（7,500トークン/日）を超えるまで質問を繰り返し、「ずんだもん、今日は一日中頑張ったから適当に答えるのだ…」というメッセージが表示され、Mixtral 8x7Bで軽量応答が返るか確認。
  - 24時間待機後、通常のDeepSeek R1応答が復元するか確認。

## 注意点
- Replitの無料枠（CPU、512MB RAM）で動作するため、負荷が高い場合処理が遅延する可能性あり。
- Discordのレート制限（50リクエスト/秒、10,000リクエスト/10分）に注意し、コードの`safe_send()`で対応。
- APIキーやトークンは安全に管理（Replit Secretsや環境変数を使用）。

## トラブルシューティング
- **エラー: 404 Not Found**:
  - DiscordチャンネルIDやBotトークンが正しいか確認。ReplitのSecretsを再確認。
- **エラー: 429 Too Many Requests**:
  - レート制限が発動しているため、1分待機後再試行。コードの`safe_send()`で自動対応済み。
- **エラー: APIキーが無効**:
  - DeepSeek APIキーが正しいか確認。Replit Secretsを更新。

## ライセンス
MITライセンス（変更可能）。